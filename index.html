<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë…¸ë˜ ì¶”ì²œê¸° ğŸµ</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 40px auto;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h1 { color: #2c3e50; text-align: center; }
    label, select, input {
      display: block;
      margin-top: 15px;
      font-size: 1em;
    }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 1em;
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background-color: #27ae60; }
    #result {
      margin-top: 30px;
      font-size: 1.1em;
      white-space: pre-line;
    }
    #loader {
      display: none;
      text-align: center;
      font-size: 1.1em;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>ğŸ¤ ì˜¤ëŠ˜ ë¶€ë¥¼ ë…¸ë˜ ì¶”ì²œë°›ê¸°</h1>

  <form id="recommendationForm">
    <label>ì¶œìƒë…„ë„: <input type="number" name="birthYear" required min="1900" max="2025"></label>
    <label>ì„±ë³„:
      <input type="radio" name="gender" value="ë‚¨ì" required> ë‚¨ì
      <input type="radio" name="gender" value="ì—¬ì"> ì—¬ì
    </label>
    <label>í˜„ì¬ ê¸°ë¶„:
      <select name="mood" required>
        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
        <option value="ì‹ ë‚¨">ì‹ ë‚¨</option>
        <option value="ìš°ìš¸í•¨">ìš°ìš¸í•¨</option>
        <option value="ì¶¤ì¶”ê³  ì‹¶ì–´">ì¶¤ì¶”ê³  ì‹¶ì–´</option>
        <option value="ì´ë³„í–ˆì–´">ì´ë³„í–ˆì–´</option>
        <option value="ì§ì‚¬ë‘ ì¤‘ì´ì•¼">ì§ì‚¬ë‘ ì¤‘ì´ì•¼</option>
        <option value="ê³ ìŒë…¸ë˜ë¥¼ ë¶€ë¥´ê³  ì‹¶ì–´">ê³ ìŒë…¸ë˜ë¥¼ ë¶€ë¥´ê³  ì‹¶ì–´</option>
      </select>
    </label>
    <button type="submit">ì¶”ì²œë°›ê¸°</button>
  </form>

  <div id="loader">ğŸ¶ AIê°€ ì„ ê³¡ ì¤‘ì…ë‹ˆë‹¤...</div>
  <div id="result"></div>

  <script>
    const loadingMessages = [
      "í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°ìœ¨ ì¤‘...",
      "ê°€ì‚¬ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...",
      "ë¦¬ë“¬ì„ íƒ€ê³  ìˆì–´ìš” ğŸ¶",
      "ì¶”ì²œí•  ê³¡ì„ ê³¨ë¼ë³´ê³  ìˆì–´ìš”..."
    ];

    document.getElementById("recommendationForm").addEventListener("submit", function(e) {
      e.preventDefault();

      document.getElementById("result").innerHTML = "";
      const loader = document.getElementById("loader");
      loader.style.display = "block";
      loader.textContent = loadingMessages[Math.floor(Math.random() * loadingMessages.length)];

      const formData = new FormData(e.target);
      const birthYear = formData.get("birthYear");
      const gender = formData.get("gender");
      const mood = formData.get("mood");

      const apiUrl = `http://localhost:5002/recommend?s=${gender}&y=${birthYear}&m=${encodeURIComponent(mood)}`;

      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
  let parsed;

  // âœ… ì´ë¯¸ JSON í˜•íƒœì¼ ê²½ìš° ë°”ë¡œ ì‚¬ìš©
  if (data.ë…¸ë˜ && data.ì•„í‹°ìŠ¤íŠ¸) {
    parsed = data;
  } else if (data.response || data.ì‘ë‹µ) {
    try {
      parsed = JSON.parse(data.response || data.ì‘ë‹µ);
    } catch (e) {
      document.getElementById("result").innerHTML =
        `<p>âŒ JSON íŒŒì‹± ì‹¤íŒ¨: ${e}</p><pre>${JSON.stringify(data)}</pre>`;
      return;
    }
  } else {
    document.getElementById("result").innerHTML =
      `<p>âŒ ì˜ëª»ëœ ì‘ë‹µ í˜•ì‹: ${JSON.stringify(data)}</p>`;
    return;
  }

  // ê²°ê³¼ ì¶œë ¥
  document.getElementById("result").innerHTML = `
    <h2>ğŸµ ì¶”ì²œ ë…¸ë˜</h2>
    <p><strong>ë…¸ë˜ ì œëª©:</strong> ${parsed.ë…¸ë˜}</p>
    <p><strong>ê°€ìˆ˜:</strong> ${parsed.ì•„í‹°ìŠ¤íŠ¸}</p>

    <p>â–¶ï¸ <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(parsed.ë…¸ë˜ + ' ' + parsed.ì•„í‹°ìŠ¤íŠ¸)}" target="_blank">YouTubeì—ì„œ ê²€ìƒ‰í•˜ê¸°</a></p>
  `;
})

        .catch(error => {
          loader.style.display = "none";
          document.getElementById("result").innerHTML = `<p style="color:red;">âŒ ì—ëŸ¬: ${error}</p>`;
        });
    });
  </script>

</body>
</html>
